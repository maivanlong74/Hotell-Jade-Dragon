
@model Jade_Dragon.Models.KhachSanTrinhChieu
@{
    ViewBag.Title = "trangchu";
    Layout = "~/Views/Shared/TongHop.cshtml";
}
<link href="~/Style/css/ThanhCuon/thanh_cuon.css" rel="stylesheet" />
<link href="~/Style/css/ThanhCuon/owl.carousel.min.css" rel="stylesheet" />
<link href="~/Style/css/ThanhCuon/owl.theme.default.min.css" rel="stylesheet" />

<body>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
    <script src="https://openlayers.org/en/v4.6.5/build/ol.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link href="~/Style/css/Map/Map_trangchu_css.css" rel="stylesheet" />

    <style>
        .map #XemMap {
            font-size: 20px;
            color: white;
            width: 100%;
            height: 10vh;
            background: #2f3640;
        }
        .map #XemMap:hover{
            color: yellow;
            font-weight: 700;
            background: none;
        }
        #map #XemKS {
            margin-left: 94vh;
            position: absolute;
            z-index: 1000;
            background-color: black;
            color: white;
        }
        #map #XemKS:hover {
            border: 3px solid yellow;
            color: yellow;
            font-weight: 700;
        }
    </style>

    <div class="home">
        <div class="home__background"></div>
        <div class="grid wide">
            <div class="row">
                <div class="home__container__slider">
                    <div class="home__container__slider--content">
                        <h1>Jade</h1>
                        <h1>dragon</h1>
                    </div>
                    <div class="home__container__slider--btn">
                        <div class="btn__bgc"></div>
                        <a href="@Url.Action("khachsan", "khachsan")">
                            Đặt ngay bây giờ
                            <span></span>
                            <span></span>
                            <span></span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="search">
        <div class="grid wide" style="display:flex;">

            <div id="dongho">
                <i>Time</i>
                <div id="clock"></div>
            </div>

            <div class="search__container">
                <form method="get" action="@Url.Action("trangchu", "trangchu")" class="row">
                    <div class="Search Search-input">
                        <input type="text" placeholder="Mời bạn nhập tìm kiếm theo" class="input" name="searchTerm" />
                    </div>
                    <div class="Search Search-select">
                        <select name="searchType" class="select">
                            <option value="all">Tất cả</option>
                            <option value="name">Tên khách sạn</option>
                            <option value="address">Địa chỉ</option>
                            <option value="phone">Số điện thoại</option>
                            <option value="khuvuc">Khu vực</option>
                        </select>
                    </div>
                    <div class="Search Search-button">
                        <button type="submit" class="button">Tìm kiếm</button>
                    </div>
                </form>
            </div>

        </div>
    </div>

    @*--------------------------------------------------------------------*@

    <div class="body keotruot" id="htkhachsan">
        <section class="slider owl-carousel owl-theme">

            @if (Model.ks.Count() > 0)
            {
                foreach (var item in Model.ks)
                {
                    if (item.AnhKs == null)
                    {
                        <div class="slider-item slider-item-one"
                             style="background: black;">
                            <div class="info">
                                <i style="font-size: 30px; margin-left: 50px; ">Chưa có ảnh !!!</i>
                                <div class="tieude">
                                    <h1>Khách sạn @item.TenKhachSan</h1>
                                </div>
                                <div class="noidung">
                                    <div class="info-a">
                                        <div class="info-b">
                                            <i class="one">Địa chỉ: @item.DiaChi</i>
                                            <p class="one">Giá: @item.Gia VND</p>
                                        </div>
                                        <div class="rating">
                                            <span class="star" data-rating="1">&#9733;</span>
                                            <span class="star" data-rating="2">&#9733;</span>
                                            <span class="star" data-rating="3">&#9733;</span>
                                            <span class="star" data-rating="4">&#9733;</span>
                                            <span class="star" data-rating="5">&#9733;</span>
                                            <input type="hidden" name="rating" class="rating-value" value="" id="so_sao">
                                            <input type="hidden" id="maks" value="@item.MaKhachSan" />
                                            <input type="hidden" id="makh" value="@Session["MaKh"]" />
                                        </div>
                                    </div>
                                    <div class="datphong" style="margin-left: 40px;">
                                        <a href="~/khachsan/khachsan?ma=@item.MaKhachSan">Đặt phòng</a>
                                        @if (item.TrangThaiKs == true)
                                        {


                                            <i>Còn phòng</i>
                                        }
                                        else
                                        {
                                            <i>Hết phòng</i>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="slider-item slider-item-one"
                             style="background-image: url('../../UpLoad_Img/KhachSan/@item.AnhKs');">
                            <div class="info">
                                <div class="tieude">
                                    <h1>Khách sạn @item.TenKhachSan</h1>
                                </div>
                                <div class="noidung">
                                    <div class="info-a">
                                        <div class="info-b">
                                            <i class="one">Địa chỉ: @item.DiaChi</i>
                                            <p class="one">Giá: @item.Gia VND</p>
                                        </div>
                                        <div class="rating">
                                            <button type="submit" class="star" id="star1" data-rating="1">&#9733;</button>
                                            <button type="submit" class="star" id="star2" data-rating="2">&#9733;</button>
                                            <button type="submit" class="star" id="star3" data-rating="3">&#9733;</button>
                                            <button type="submit" class="star" id="star4" data-rating="4">&#9733;</button>
                                            <button type="submit" class="star" id="star5" data-rating="5">&#9733;</button>
                                            <input type="hidden" name="rating" class="rating-value" value="" id="so_sao">
                                            <input type="hidden" id="maks" value="@item.MaKhachSan" />
                                            <input type="hidden" id="makh" value="@Session["MaKh"]" />
                                        </div>
                                    </div>
                                    <div class="datphong" style="margin-left: 40px;">
                                        <a href="~/khachsan/khachsan?ma=@item.MaKhachSan">Đặt phòng</a>
                                        @if (item.TrangThaiKs == true)
                                        {


                                            <i>Còn phòng</i>
                                        }
                                        else
                                        {
                                            <i>Hết phòng</i>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            }
            else
            {
                <div class="slider-item slider-item-one"
                     style="background: black;">
                    <div class="info">
                        <div style="padding: 120px">
                            <i style="font-size: 35px;">Khu vực này chưa có khách sạn</i>
                        </div>
                    </div>
                </div>
            }

        </section>

        <div class="map">
            <div class="centent">
                <h1>Khu Vực</h1>
            </div>
            <div class="list-map">
                <ul>
                    <li><a href="~/trangchu/trangchu">TẤT CẢ</a></li>
                    @foreach (var item in Model.kv)
                    {
                        <li><a href="~/trangchu/trangchu?ma=@item.MaKhuVuc">@item.TenKhuVuc</a></li>
                    }
                </ul>
            </div>
            <div>
                <button id="XemMap">Xem bản đồ</button>
            </div>
        </div>
    </div>

    @*--------------------------------------------------------------------------------*@

    <div class="package">
        <div class="package__background" style="background-image: url('../../Style/img/nen.jpg'); "></div>
        <div class="package__container">
            <div class="grid wide">
                <div class="package__container___body">
                    <div class="package__container___body--content">
                        <div class="body--content__cta">
                            <h2>Những khu khách sạn cao cấp</h2>
                            <div class="item_rating">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="far fa-star"></i>
                            </div>
                            <p>
                                Những khu khách sạn cao cấp, mang đến cho khách hàng những trải nghiệm tuyệt vời. <br>
                                Khách sạn đầy đủ tiện nghi, nhân viên phục vụ tận tình.
                            </p>
                        </div>
                        <div class="item--btn">
                            <div class="btn__bgc"></div>
                            <a href="@Url.Action("khachsan", "khachsan")">
                                Đặt ngay bây giờ
                                <span></span>
                                <span></span>
                                <span></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @*-------------------------------------------------------------------------*@

    <div id="map">
        <div><button id="XemKS">Xem Khách Sạn</button></div>
        <div class="Search-Search">
            <input type="text" id="search-input" placeholder="Tìm kiếm địa điểm">
            <button id="search-button">Tìm kiếm</button>
        </div>
        <div class="DangKy_Map" id="DangKy_Map">
            <form id="register-form" action="/Admin/QLKhachSan/DangKyKs" method="post" enctype="multipart/form-data"></form>
        </div>
        <div id="popup" class="popup"></div>
    </div>

    @*-------------------------------------------------------------------------*@

    <div class="offers">
        <div class="offers__container">
            <div class="grid wide">
                <div class="dulich">
                    <div class="tieude">
                        <h2>Gợi ý các điểm chụp ảnh đẹp ở Huế</h2>
                        <ol>
                            <li>Đại Nội</li>
                            <li>Phố đi bộ</li>
                            <li>Đồi Vọng Cảnh</li>
                            <li>Cầu gỗ lim</li>
                            <li>Đồi Thiên An</li>
                        </ol>
                    </div>
                    <div class="hinhanh">
                        <div class="a1">
                            <div>
                                <img src="~/Style/img/chup_anh/1.jpg" />
                            </div>
                            <div>
                                <img src="~/Style/img/chup_anh/2.jpg" class="a" />
                            </div>
                        </div>
                        <div class="a2">
                            <div>
                                <img src="~/Style/img/chup_anh/3.jpg" class="b" />
                            </div>
                            <div>
                                <img src="~/Style/img/chup_anh/4.jpg" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var hotels = [
          @foreach (var i in Model.ks) {
              <text>{
                maks: '@i.MaKhachSan',
                name: '@i.TenKhachSan',
                address: '@i.DiaChi',
                phone: '@i.SoDienThoai',
                gmail: '@i.Gmail',
                moeny: '@i.Gia',
                avt: '@i.AnhKs',
                coordinates: [@i.KinhDo, @i.ViDo]
            },</text>
          }
        ];
    </script>
    @*<script src="~/Style/js/Map/Map_trangchu.js"></script>*@
    <script>
        var map;
        function initMap(hotels) {
            map = new ol.Map({
                target: 'map',
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.OSM()
                    })
                ],
            });
            // ------------------------------
            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = ol.proj.fromLonLat([position.coords.longitude, position.coords.latitude]);
                    var data = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                    var marker = new ol.Feature({
                        geometry: new ol.geom.Point(pos)
                    });
                    var markerSource = new ol.source.Vector({
                        features: [marker]
                    });
                    var markerLayer = new ol.layer.Vector({
                        source: markerSource
                    });
                    map.addLayer(markerLayer);
                    map.getView().setCenter(pos);
                    map.getView().setZoom(15);
                });
            } else {
                alert('Định vị địa lý không được trình duyệt của bạn hỗ trợ');
            }

            // Thêm control để xác định vị trí hiện tại
            var geolocation = new ol.Geolocation({
                trackingOptions: {
                    enableHighAccuracy: true
                },
                projection: map.getView().getProjection()
            });
            var positionFeature = new ol.Feature();
            positionFeature.setStyle(new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 6,
                    fill: new ol.style.Fill({
                        color: '#3399CC'
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#fff',
                        width: 2
                    })
                })
            }));

            // Xử lý thông tin địa điểm khi click vào bản đồ
            map.on('singleclick', function (evt) {
                var maks = $('#maks_map').val();

                if (maks == null || maks.trim() == '') {
                    return;
                } else {
                    handlePosition();
                }

            });

            function handlePosition() {


                // Hiển thị thông tin lên bản đồ
                var div_form = document.getElementById("DangKy_Map");
                var formdk = document.getElementById("register-form");
                if (formdk) {
                    formdk.style.background = "rgba(0, 0, 0, 0.7)";
                    div_form.style.zIndex = "999";
                    formdk.innerHTML = `
                        <label for="name">Tên khách sạn:</label>
                        <input style="margin-left: 10px;" type="text" id="TenKhachSan" name="TenKhachSan" required> <br/>

                        <label for="phone">Số điện thoại:</label>
                        <input style="margin-left: 24px;" type="tel" id="SoDienThoai" name="SoDienThoai" required> <br/>

                        <label for="email">Email:</label>
                        <input style="margin-left: 80px;" type="email" id="Gmail" name="Gmail" required> <br/>

                        <button type="submit">Đăng ký</button>`;
                }
            }

            // Thêm control zoom slider
            var zoomSlider = new ol.control.ZoomSlider();
            map.addControl(zoomSlider);
            // Thêm control full screen
            var fullScreen = new ol.control.FullScreen();
            map.addControl(fullScreen);
            // Thêm control OverviewMap
            var OverviewMap = new ol.control.OverviewMap();
            map.addControl(OverviewMap);
            // Thêm control ScaleLine
            var ScaleLine = new ol.control.ScaleLine();
            map.addControl(ScaleLine);


            /*--------*/
            // Lấy các phần tử input và button tìm kiếm
            var searchInput = document.getElementById('search-input');
            var searchButton = document.getElementById('search-button');

            // Xử lý sự kiện click vào nút tìm kiếm
            searchButton.addEventListener('click', function () {
                var searchText = searchInput.value;
                if (searchText !== '') {
                    // Kiểm tra xem người dùng đã nhập vào một từ khóa hay là một tọa độ
                    if (isNaN(searchText)) {
                        // Tìm kiếm địa điểm dựa trên từ khóa
                        searchPlaceByName(searchText);
                    } else {
                        // Chuyển đổi tọa độ kinh độ/vĩ độ thành đối tượng OpenLayers và di chuyển marker tới vị trí đó
                        var coordinates = [parseFloat(searchText.split(',')[0]), parseFloat(searchText.split(',')[1])];
                        var pos = ol.proj.fromLonLat(coordinates);
                        marker.getGeometry().setCoordinates(pos);
                        // Set lại center của map
                        map.getView().setCenter(pos);
                        map.getView().setZoom(15);
                    }
                }
            });

            // Xử lý sự kiện nhấn phím Enter để gửi tin nhắn
            $('#search-input').keypress(function (e) {
                if (e.which === 13) { // Kiểm tra xem phím Enter đã được bấm chưa
                    var searchText = searchInput.value;
                    if (searchText !== '') {
                        // Kiểm tra xem người dùng đã nhập vào một từ khóa hay là một tọa độ
                        if (isNaN(searchText)) {
                            // Tìm kiếm địa điểm dựa trên từ khóa
                            searchPlaceByName(searchText);
                        } else {
                            // Chuyển đổi tọa độ kinh độ/vĩ độ thành đối tượng OpenLayers và di chuyển marker tới vị trí đó
                            var coordinates = [parseFloat(searchText.split(',')[0]), parseFloat(searchText.split(',')[1])];
                            var pos = ol.proj.fromLonLat(coordinates);
                            marker.getGeometry().setCoordinates(pos);
                            // Set lại center của map
                            map.getView().setCenter(pos);
                            map.getView().setZoom(15);
                        }
                    }
                }
            });

            // Hàm tìm kiếm địa điểm dựa trên từ khóa
            function searchPlaceByName(searchText) {
                var url = `https://nominatim.openstreetmap.org/search?q=${searchText}&format=json`;
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            var result = data[0];
                            var pos = ol.proj.fromLonLat([parseFloat(result.lon), parseFloat(result.lat)]);
                            // Di chuyển marker tới vị trí tìm kiếm được
                            marker.getGeometry().setCoordinates(pos);
                            // Set lại center của map
                            map.getView().setCenter(pos);
                            map.getView().setZoom(18);
                        } else {
                            alert('Không tìm thấy địa điểm');
                        }
                    })
            }

            // Tạo một đối tượng marker
            var marker = new ol.Feature({
                geometry: new ol.geom.Point(ol.proj.fromLonLat([0, 0]))
            });

            marker.setStyle(new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 1],
                    src: 'https://openlayers.org/en/latest/examples/data/icon.png'
                })
            }));

            // Tạo một lớp vector để chứa marker
            var vectorLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: [marker]
                })
            });
            // Thêm lớp vector vào bản đồ
            map.addLayer(vectorLayer);

            // Tạo các lớp vector và thêm chúng vào bản đồ
            hotels.forEach(function (lonlat) {
                var vectorLayer = Search_KD_VD(lonlat);
                map.addLayer(vectorLayer);
            });

            var overlays = [];
            var maks_map = null;

            function Search_KD_VD(location) {
                var lon = location.coordinates[0];
                var lat = location.coordinates[1];
                maks_map = location.maks || null;
                var name = location.name;
                var address = location.address;
                var phone = location.phone;
                var gmail = location.gmail;
                var moeny = location.moeny;
                var avtks = location.avt;

                // Tạo feature của marker với nội dung thông tin khách sạn tương ứng
                var marker = new ol.Feature({
                    geometry: new ol.geom.Point(ol.proj.fromLonLat([lon, lat])),
                    content:
                        `<div style="background-color: black; color: wheat; width: 400px; word-wrap: break-word; padding: 10px; border: 2px solid yellow; cursor: pointer;">` +
                        `<input type="hidden" id="maks_map" value="` + maks_map + `"/>` +
                        '<div><strong id="tenks_map"> Khách Sạn: ' + name + '</strong></div>' +
                        '<div id="diachiks_map">Địa chỉ: ' + address + '</div>' +
                        '<div id="sdtks_map">Số điện thoại: ' + phone + '</div>' +
                        '<div id="gmailks_map">Gmail: ' + gmail + '</div>' +
                        '<div id="giaks_map">Giá tiền: ' + moeny + '</div>' +
                        `<input type="hidden" id="avtks_map" value="` + avtks + `"/>` +
                        `</div>`,
                    maks: maks_map
                });
                marker.setStyle(new ol.style.Style({
                    image: new ol.style.Icon({
                        anchor: [0.5, 1],
                        src: 'https://openlayers.org/en/latest/examples/data/icon.png'
                    })
                }));

                var vectorLayer = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: [marker]
                    })
                });

                // Tạo một interaction để chọn feature
                var selectInteraction = new ol.interaction.Select({
                    layers: [vectorLayer],
                });

                // Thêm interaction vào map
                map.addInteraction(selectInteraction);

                // Tạo overlay cho feature marker để hiển thị thông tin khách sạn khi hover chuột vào
                var popup = new ol.Overlay({
                    element: document.createElement('div'),
                    autoPan: false,
                    autoPanAnimation: {
                        duration: 250
                    },
                    positioning: "bottom-center",
                    stopEvent: false,
                    offset: [0, -50],
                });
                map.addOverlay(popup);

                map.on('pointermove', function (evt) {
                    var feature = map.forEachFeatureAtPixel(evt.pixel,
                        function (feature, layer) {
                            return feature;
                        });
                    if (feature) {
                        var coordinates = feature.getGeometry().getCoordinates();
                        var maks_map = feature.get('maks') || null;
                        if (maks_map) {
                            popup.getElement().innerHTML = `<input type="hidden" id="maks_map" value="${maks_map}"/>` + feature.get('content');
                        } else {
                            popup.getElement().innerHTML = feature.get('content');
                        }
                        popup.setPosition(coordinates);
                        popup.getElement().style.display = 'block';
                    } else {
                        $('#maks_map').val(null);
                        popup.getElement().style.display = 'none';
                    }
                });

                return vectorLayer;
            }

            map.on('pointermove', function (evt) {
                var feature = map.forEachFeatureAtPixel(evt.pixel,
                    function (feature, layer) {
                        return feature;
                    });
                if (feature) {
                    var coordinates = feature.getGeometry().getCoordinates();
                    popup.setPosition(coordinates);
                    var content = feature.get('content');
                    document.getElementById('popup').innerHTML = content;
                } else {
                    popup.setPosition(undefined);
                    map.getViewport().style.cursor = '';
                }
            });

            map.on('pointerout', function () {
                popup.setPosition(undefined);
                map.getViewport().style.cursor = '';
            });
            return map;
        }
    </script>
    <script>var map = initMap(hotels);</script>
</body>

<script src="~/Style/js/KeoTruot.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="~/Style/css/ThanhCuon/owl.carousel.min.js"></script>
<script src="~/Style/css/ThanhCuon/Cuon.js"></script>
<script src="~/Style/js/DongHo.js"></script>



