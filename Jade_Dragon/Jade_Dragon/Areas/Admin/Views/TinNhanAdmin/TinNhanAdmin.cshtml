
@{
    ViewBag.Title = "TinNhanAdmin";
    Layout = "~/Areas/Admin/Views/Shared/LayoutAdmin.cshtml";
}
<link href="~/Areas/Admin/Public/css/css_ChatAdmin.css" rel="stylesheet" />

<style>
    
</style>

<div class="home">
    <div class="body">
        <div class="body-chat">
            <div class="body-item-chat">
                <div class="list-chat">
                    <div style="height: 5%;"></div>
                    <div class="list-Group list-chat-a">
                        <span>Nhóm chat</span>
                        <ul>
                            <li>Tất cả</li>
                            <li>Jade Dragon</li>
                        </ul>
                    </div>
                    <div class="list-User list-chat-a">
                        <span>Khách hàng</span>
                        <ul>
                            <li>Mai Văn Long</li>
                            <li>Hồ Thị Như Ngọc</li>
                        </ul>
                    </div>
                </div>
                <div class="htchat">
                    <div id="tenphong"></div>
                    <ul id="contentMsg"></ul>
                </div>
            </div>
            <div class="body-send-chat">
                <input type="hidden" id="hName" value="@Session["HoTen"]" />
                <input type="hidden" id="idphong" value="1" />
                <input type="text" id="txtMessage" placeholder="Nhập chat" class="txtchat" />
                <button type="submit" id="btnSend" class="txtchat">Gửi</button>
            </div>
        </div>
    </div>
</div>

<script src="~/Scripts/jquery-1.10.2.js"></script>
<script src="~/Scripts/jquery.signalR-2.4.3.min.js"></script>
<script src="~/signalr/hubs"></script>

<script>
    $(function () {
        var chat = $.connection.chat;

        loadClient(chat);

        $.connection.hub.start().done(function () {
            $('#btnSend').click(function () {
                sendMessage(chat);
            });

            $('#txtMessage').keypress(function (e) {
                if (e.which === 13) { // Kiểm tra xem phím Enter đã được bấm chưa
                    sendMessage(chat);
                }
            });

            // Lấy danh sách tin nhắn trong phòng chat và hiển thị lên
            var roomId = $('#idphong').val();
            chat.server.getMessages(roomId);
        });
    });

    function sendMessage(chat) {
        var roomId = $('#idphong').val();
        var msg = $('#txtMessage').val();
        var makh = $('#makh').val();
        chat.server.message(roomId, makh, msg);
        $('#txtMessage').val('').focus();
    }

    var isRoomNameSet = false;
    function loadClient(chat) {
        chat.client.message = function (tenphong, name, msg) {
            $('#contentMsg').append("<li><strong>" + name + "</strong>: " + msg + "</li>");
            if (!isRoomNameSet) { // kiểm tra xem tên phòng chat đã được hiển thị chưa
                $('#tenphong').append("<i>" + tenphong + "</i>");
                isRoomNameSet = true;
            }
        }
    }

</script>